"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_dom=_interopRequireWildcard(require("../../tools/dom"));function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(_getRequireWildcardCache=function(e){return e?o:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var o,n,l={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((n=r?Object.getOwnPropertyDescriptor(e,o):null)&&(n.get||n.set)?Object.defineProperty(l,o,n):l[o]=e[o]);return l.default=e,t&&t.set(e,l),l}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getTargetOffset(e,t){var o,n,l=0,r=0,i=!_dom.browse.firefox&&_dom.default.hasClass(e,"vxe-checkbox--label");for(i&&(o=getComputedStyle(e),l-=_xeUtils.default.toNumber(o.paddingTop),r-=_xeUtils.default.toNumber(o.paddingLeft));e&&e!==t;)l+=e.offsetTop,r+=e.offsetLeft,e=e.offsetParent,i&&(n=getComputedStyle(e),l-=_xeUtils.default.toNumber(n.paddingTop),r-=_xeUtils.default.toNumber(n.paddingLeft));return{offsetTop:l,offsetLeft:r}}function getCheckboxRangeRows(e,t,o,n){var l=0,r=[],i=0<n,c=0<n?n:Math.abs(n)+o.offsetHeight,s=e.afterFullData,n=e.scrollYStore;if(e.scrollYLoad)t=e.getVTRowIndex(t.row),r=i?s.slice(t,t+Math.ceil(c/n.rowHeight)):s.slice(t-Math.floor(c/n.rowHeight)+1,t+1);else for(var u=i?"next":"previous";o&&l<c;)r.push(e.getRowNode(o).item),l+=o.offsetHeight,o=o["".concat(u,"ElementSibling")];return r}var _default={methods:{moveTabSelected:function(e,t,o){var n,l,r,i=this,c=this.afterFullData,s=this.visibleColumn,u=this.editConfig,a=this.editOpts,d=Object.assign({},e),f=this.getVTRowIndex(d.row),e=this.getVTColumnIndex(d.column);o.preventDefault(),t?e<=0?0<f&&(n=c[l=f-1],r=s.length-1):r=e-1:e>=s.length-1?f<c.length-1&&(n=c[l=f+1],r=0):r=e+1;s=s[r];s&&(n?(d.rowIndex=l,d.row=n):d.rowIndex=f,d.columnIndex=r,d.column=s,d.cell=this.getCell(d.row,d.column),u?"click"!==a.trigger&&"dblclick"!==a.trigger||("row"===a.mode?this.handleActived(d,o):this.scrollToRow(d.row,d.column).then(function(){return i.handleSelected(d,o)})):this.scrollToRow(d.row,d.column).then(function(){return i.handleSelected(d,o)}))},moveCurrentRow:function(e,t,o){var n,l,r,i=this,c=this.currentRow,s=this.treeConfig,u=this.treeOpts,a=this.afterFullData;o.preventDefault(),c?s?(l=(u=_xeUtils.default.findTree(a,function(e){return e===c},u)).index,u=u.items,e&&0<l?n=u[l-1]:t&&l<u.length-1&&(n=u[l+1])):(l=this.getVTRowIndex(c),e&&0<l?n=a[l-1]:t&&l<a.length-1&&(n=a[l+1])):n=a[0],n&&(r={$table:this,row:n},this.scrollToRow(n).then(function(){return i.triggerCurrentRowEvent(o,r)}))},moveSelected:function(e,t,o,n,l,r){var i=this,c=this.afterFullData,s=this.visibleColumn,u=Object.assign({},e),a=this.getVTRowIndex(u.row),e=this.getVTColumnIndex(u.column);r.preventDefault(),o&&0<a?(u.rowIndex=a-1,u.row=c[u.rowIndex]):l&&a<c.length-1?(u.rowIndex=a+1,u.row=c[u.rowIndex]):t&&e?(u.columnIndex=e-1,u.column=s[u.columnIndex]):n&&e<s.length-1&&(u.columnIndex=e+1,u.column=s[u.columnIndex]),this.scrollToRow(u.row,u.column).then(function(){u.cell=i.getCell(u.row,u.column),i.handleSelected(u,r)})},triggerHeaderCellMousedownEvent:function(e,t){var o,n=this.mouseConfig,l=this.mouseOpts;n&&l.area&&this.handleHeaderCellAreaEvent&&(o=e.currentTarget,n=_dom.default.getEventTargetNode(e,o,"vxe-cell--sort").flag,l=_dom.default.getEventTargetNode(e,o,"vxe-cell--filter").flag,this.handleHeaderCellAreaEvent(e,Object.assign({cell:o,triggerSort:n,triggerFilter:l},t))),this.focus(),this.closeMenu()},triggerCellMousedownEvent:function(e,t){var o=e.currentTarget;t.cell=o,this.handleCellMousedownEvent(e,t),this.focus(),this.closeFilter(),this.closeMenu()},handleCellMousedownEvent:function(e,t){var o=this.editConfig,n=this.editOpts,l=this.handleSelected,r=this.checkboxConfig,i=this.checkboxOpts,c=this.mouseConfig,s=this.mouseOpts;if(c&&s.area&&this.handleCellAreaEvent)return this.handleCellAreaEvent(e,t);r&&i.range&&this.handleCheckboxRangeEvent(e,t),c&&s.selected&&(o&&"cell"!==n.mode||l(t,e))},handleCheckboxRangeEvent:function(e,c){var t,o,s,u,a,d,n,l,f,h,g,m,p,v,x,b,w,y,C,R,_,T,r,k=this,i=c.column,O=c.cell;"checkbox"===i.type&&(t=this.$el,o=this.elemStore,s=e.clientX,u=e.clientY,a=o["".concat(i.fixed||"main","-body-wrapper")]||o["main-body-wrapper"],d=a.querySelector(".vxe-table--checkbox-range"),n=document.onmousemove,l=document.onmouseup,f=O.parentNode,h=this.getCheckboxRecords(),g=[],m=1,O=getTargetOffset(e.target,a),p=O.offsetTop+e.offsetY,v=O.offsetLeft+e.offsetX,x=a.scrollTop,b=f.offsetHeight,w=null,y=!1,C=1,R=function(e,t){k.emitEvent("checkbox-range-".concat(e),{records:k.getCheckboxRecords(),reserves:k.getCheckboxReserveRecords()},t)},_=function(e){var t=e.clientX,o=e.clientY,n=t-s,l=o-u+(a.scrollTop-x),r=Math.abs(l),i=Math.abs(n),t=p,o=v;l<m?(t+=l)<m&&(t=m,r=p):r=Math.min(r,a.scrollHeight-p-m),n<m?(o+=n,v<i&&(o=m,i=v)):i=Math.min(i,a.clientWidth-v-m),d.style.height="".concat(r,"px"),d.style.width="".concat(i,"px"),d.style.left="".concat(o,"px"),d.style.top="".concat(t,"px"),d.style.display="block";l=getCheckboxRangeRows(k,c,f,l<m?-r:r);10<r&&l.length!==g.length&&(g=l,e.ctrlKey?l.forEach(function(e){k.handleSelectRow({row:e},-1===h.indexOf(e))}):(k.setAllCheckboxRow(!1),k.setCheckboxRow(l,!0)),R("change",e))},T=function(){clearTimeout(w),w=null},r=function r(i){T(),w=setTimeout(function(){var e,t,o,n,l;w&&(e=a.scrollLeft,t=a.scrollTop,o=a.clientHeight,n=a.scrollHeight,l=Math.ceil(50*C/b),y?t+o<n?(k.scrollTo(e,t+l),r(i),_(i)):T():t?(k.scrollTo(e,t-l),r(i),_(i)):T())},50)},_dom.default.addClass(t,"drag--range"),document.onmousemove=function(e){e.preventDefault(),e.stopPropagation();var t=e.clientY,o=_dom.default.getAbsolutePos(a).boundingTop;t<o?(y=!1,C=o-t,w||r(e)):t>o+a.clientHeight?(y=!0,C=t-o-a.clientHeight,w||r(e)):w&&T(),_(e)},document.onmouseup=function(e){T(),_dom.default.removeClass(t,"drag--range"),d.removeAttribute("style"),document.onmousemove=n,document.onmouseup=l,R("end",e)},R("start",e))}}};exports.default=_default;